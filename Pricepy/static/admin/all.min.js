var adminApp=angular.module("adminApp",["ngRoute","ngSanitize","ngCookies","720kb.datepicker"]);adminApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"static/admin/templates/signin.htm",controller:"signinController"}).when("/gallery",{templateUrl:"static/admin/templates/gallery.htm",controller:"galleryController"}).when("/news",{templateUrl:"static/admin/templates/news.htm",controller:"newsController"})}]),adminApp.controller("adminController",["$scope","$location","$http","getData","dateService",function(e,n,o,t,a){e.path=n.path(),console.log("hello from Admin"),t.getContent("/api/Values","header").then(function(n){e.data={},e.data.header=n,console.log(e.data),t.getContent("/api/Values","footer").then(function(n){e.data.footer=n,console.log(e.data)})})}]),adminApp.controller("galleryController",["$scope","$location","$http","getData","postData","myVars","dateService",function(e,n,o,t,a,r,l){console.log("gallery controller runs"),e.$parent.path="/gallery",e.isDataUpdated=!1,t.getContent("/api/AdminValues","adminGallery").then(function(o){console.log("in gallery controller"),console.log(o),e.data=o,t.getContent("/api/AdminValues","machines").then(function(o){console.log(o),null==o?n.path("/"):e.machines=o})}),e.clearAvailibilityTextBox=function(e){e.availibilityLabel="",e.availibilityDate=null},e.editFullInfo=function(n){e.isDisplayFullInfoPanel=!0,e.activeItem=n},e.isExpired=function(e){return l.isExpired(e)},e.save=function(){if(console.log("save called"),!e.galleryForm.$invalid&&!e.galleryForm.$pristine||!e.fullInfoForm.$invalid&&!e.fullInfoForm.$pristine){e.updatedMachines=[];for(var n=0;n<e.machines.gallery.items.length;n++){var o={},t=e.machines.gallery.items[n];o.Name=t.name,o.IsAvailable=t.availibility,o.AvailibilityLabel=t.availibilityLabel,o.AvailibilityDate=t.availibilityDate,o.IsDiscount=t.discount,o.Price=t.price,o.FullInfo=JSON.stringify(t.fullInfo),e.updatedMachines.push(o)}console.log("short collection:"),console.log(e.updatedMachines),a.postContent("/api/Gallery",e.updatedMachines).then(function(n){!n.isError&&n.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}}}]),adminApp.controller("newsController",["$scope","$location","getData","postData",function(e,n,o,t){console.log("news controller runs"),e.$parent.path="/news",e.isDataUpdated=!1,o.getContent("/api/Values","home").then(function(n){console.log(n),e.data=n}),e.postToServer=function(){if(!e.newsForm.$invalid&&!e.newsForm.$pristine){var n=JSON.stringify(JSON.stringify(e.data.sections));t.postContent("/api/News",n).then(function(n){!n.isError&&n.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}},e.postImage=function(){e.myFile&&t.postFile("/api/Image",e.myFile).then(function(e){!e.isError&&e.data?(console.log("success"),console.log(e.data)):(console.log("error"),console.log(e))})}}]),adminApp.controller("scrollToAnchorController",["$scope","anchorSmoothScroll",function(e,n){e.gotoElement=function(e){n.scrollTo(e)}}]),adminApp.controller("signinController",["$scope","$http","$location","$cookies","getData","postData","myVars",function(e,n,o,t,a,r,l){console.log("sign in controller runs"),e.$parent.path="/sign in",e.isError=!1,a.getContent("/api/Values","signin").then(function(n){e.data=n,console.log(e.data),e.submit=function(){e.messagesForm.$invalid||r.postContent("/api/AdminValues",e.form).then(function(n){!n.isError&&n.data?(e.isError=!1,l.tokenValue=n.data.Value,t.put("X-Token",l.tokenValue),o.path("/gallery")):(e.isError=!0,console.log("error occured on our server"),console.log(n))})}})}]),adminApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(n,o,t){var a=e(t.fileModel),r=a.assign;o.bind("change",function(){n.$apply(function(){r(n,o[0].files[0])})})}}}]),adminApp.service("anchorSmoothScroll",function(){this.scrollTo=function(e){var n=function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}(),o=function(e){for(var n=document.getElementById(e),o=n.offsetTop,t=n;t.offsetParent&&t.offsetParent!=document.body;)t=t.offsetParent,o+=t.offsetTop;return o}(e),t=o>n?o-n:n-o;if(t<100)return void scrollTo(0,o);var a=Math.round(t/100);a>=20&&(a=20);var r=Math.round(t/25),l=o>n?n+r:n-r,i=0;if(o>n)for(var s=n;s<o;s+=r)setTimeout("window.scrollTo(0, "+l+")",i*a),l+=r,l>o&&(l=o),i++;else for(var s=n;s>o;s-=r)setTimeout("window.scrollTo(0, "+l+")",i*a),l-=r,l<o&&(l=o),i++}}),adminApp.service("dateService",function(){return{isExpired:function(e){if(e){return new Date>new Date(e)}return null}}}),adminApp.service("getData",["$http","$cookies","myVars",function(e,n,o){return{getContent:function(t,a){var r=o.tokenValue;return console.log("token value inside GETDATA service:"),console.log(r),r||(r=n.get("X-Token")),console.log("X-token"),console.log(r),e({method:"Get",url:t,params:{sectionName:a},headers:{"X-Token":r}}).then(function(e){return e.data},function(e){console.log("error")})}}}]),adminApp.service("postData",["$http","$cookies","myVars",function(e,n,o){var t=function(e){var t=o.tokenValue;return t||(t=n.get("X-Token")),e?e["X-Token"]=t:e={"X-Token":t},e};return{postContent:function(n,o,a){return e({method:"POST",url:n,data:o,headers:t(a)}).then(function(e){return e},function(e){return e.isError=!0,e})},postFile:function(n,o,a){var r=new FormData;return r.append("file",o),a?a["Content-Type"]=void 0:a={"Content-Type":void 0},e({method:"POST",url:n,data:r,transformRequest:angular.identity,headers:t(a)}).then(function(e){return e},function(e){return e.isError=!0,e})}}}]),adminApp.value("myVars",{tokenValue:null});