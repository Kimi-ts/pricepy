var adminApp=angular.module("adminApp",["ngRoute","ngSanitize","ngCookies","720kb.datepicker"]);adminApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"static/admin/templates/signin.htm",controller:"signinController"}).when("/gallery",{templateUrl:"static/admin/templates/gallery.htm",controller:"galleryController"}).when("/news",{templateUrl:"static/admin/templates/news.htm",controller:"newsController"})}]),adminApp.controller("adminController",["$scope","$location","$http","getData","dateService",function(e,o,n,t,l){e.path=o.path(),console.log("hello from Admin"),t.getContent("/api/Values","header").then(function(o){e.data={},e.data.header=o,console.log(e.data),t.getContent("/api/Values","footer").then(function(o){e.data.footer=o,console.log(e.data)})})}]),adminApp.controller("galleryController",["$scope","$location","$http","getData","myVars","dateService",function(e,o,n,t,l,a){console.log("gallery controller runs"),e.$parent.path="/gallery",e.isDataUpdated=!1,t.getContent("/api/AdminValues","adminGallery").then(function(n){console.log("in gallery controller"),console.log(n),e.data=n,t.getContent("/api/AdminValues","machines").then(function(n){console.log(n),null==n?o.path("/"):e.machines=n})}),e.clearAvailibilityTextBox=function(e){e.availibilityLabel="",e.availibilityDate=null},e.editFullInfo=function(o){e.isDisplayFullInfoPanel=!0,e.activeItem=o},e.isExpired=function(e){return a.isExpired(e)},e.save=function(){if(console.log("save called"),!e.galleryForm.$invalid&&!e.galleryForm.$pristine||!e.fullInfoForm.$invalid&&!e.fullInfoForm.$pristine){var o=l.tokenValue;console.log("im sensing data"),e.updatedMachines=[];for(var t=0;t<e.machines.gallery.items.length;t++){var a={},r=e.machines.gallery.items[t];a.Name=r.name,a.IsAvailable=r.availibility,a.AvailibilityLabel=r.availibilityLabel,a.AvailibilityDate=r.availibilityDate,a.IsDiscount=r.discount,a.Price=r.price,a.FullInfo=JSON.stringify(r.fullInfo),e.updatedMachines.push(a)}console.log("short collection:"),console.log(e.updatedMachines),n({method:"POST",url:"/api/Gallery",data:e.updatedMachines,contentType:"application/x-www-form-urlencoded",headers:{"X-Token":o}}).then(function(o){console.log("finally returned:"),console.log(o),o.data?(console.log("true"),e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}}}]),adminApp.controller("newsController",["$scope","$location","$http","getData","myVars",function(e,o,n,t,l){console.log("news controller runs"),e.$parent.path="/news",e.isDataUpdated=!1,t.getContent("/api/Values","home").then(function(o){console.log(o),e.data=o}),e.postToServer=function(){if(!e.newsForm.$invalid&&!e.newsForm.$pristine){var o=l.tokenValue,t=JSON.stringify(JSON.stringify(e.data.sections));n({method:"POST",url:"/api/News",data:t,contentType:"application/x-www-form-urlencoded",headers:{"X-Token":o}}).then(function(o){o.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}}}]),adminApp.controller("scrollToAnchorController",["$scope","anchorSmoothScroll",function(e,o){e.gotoElement=function(e){o.scrollTo(e)}}]),adminApp.controller("signinController",["$scope","$http","$location","$cookies","getData","myVars",function(e,o,n,t,l,a){console.log("sign in controller runs"),e.$parent.path="/sign in",e.isError=!1,l.getContent("/api/Values","signin").then(function(l){e.data=l,console.log(e.data),e.submit=function(){e.messagesForm.$invalid||o({method:"POST",url:"/api/AdminValues",data:e.form}).then(function(o){console.log(o),o.data?(console.log("true"),e.isError=!1,a.tokenValue=o.data.Value,t.put("X-Token",a.tokenValue),n.path("/gallery")):e.isError=!0},function(o){e.isError=!0,console.log("error occured on our server"),console.log(o)})}})}]),adminApp.service("anchorSmoothScroll",function(){this.scrollTo=function(e){var o=function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}(),n=function(e){for(var o=document.getElementById(e),n=o.offsetTop,t=o;t.offsetParent&&t.offsetParent!=document.body;)t=t.offsetParent,n+=t.offsetTop;return n}(e),t=n>o?n-o:o-n;if(t<100)return void scrollTo(0,n);var l=Math.round(t/100);l>=20&&(l=20);var a=Math.round(t/25),r=n>o?o+a:o-a,i=0;if(n>o)for(var s=o;s<n;s+=a)setTimeout("window.scrollTo(0, "+r+")",i*l),r+=a,r>n&&(r=n),i++;else for(var s=o;s>n;s-=a)setTimeout("window.scrollTo(0, "+r+")",i*l),r-=a,r<n&&(r=n),i++}}),adminApp.service("dateService",function(){return{isExpired:function(e){if(e){return new Date>new Date(e)}return null}}}),adminApp.service("getData",["$http","$cookies","myVars",function(e,o,n){return{getContent:function(t,l){var a=n.tokenValue;return console.log("token value inside GETDATA service:"),console.log(a),a||(a=o.get("X-Token")),console.log("X-token"),console.log(a),e({method:"Get",url:t,params:{sectionName:l},headers:{"X-Token":a}}).then(function(e){return e.data},function(e){console.log("error")})}}}]),adminApp.value("myVars",{tokenValue:null});