var adminApp=angular.module("adminApp",["ngRoute","ngSanitize","ngCookies","720kb.datepicker"]);adminApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"static/admin/templates/signin.htm",controller:"signinController"}).when("/gallery",{templateUrl:"static/admin/templates/gallery.htm",controller:"galleryController"}).when("/news",{templateUrl:"static/admin/templates/news.htm",controller:"newsController"})}]),adminApp.controller("adminController",["$scope","$location","$http","getData","dateService",function(e,n,t,o,a){e.path=n.path(),console.log("hello from Admin"),o.getContent("/api/Values","header").then(function(n){e.data={},e.data.header=n,console.log(e.data),o.getContent("/api/Values","footer").then(function(n){e.data.footer=n,console.log(e.data)})})}]),adminApp.controller("addNewsController",["$scope","$location","getData","postData",function(e,n,t,o){console.log("add news controller runs"),e.$parent.path="/news",e.isDataUpdated=!1,t.getContent("/api/Values","home").then(function(n){console.log(n),e.data=n}),e.postToServer=function(){if(!e.newsForm.$invalid&&!e.newsForm.$pristine){var n=JSON.stringify(JSON.stringify(e.data.sections));o.postContent("/api/News",n).then(function(n){!n.isError&&n.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}},e.postImage=function(){e.myFile&&o.postFile("/api/Image",e.myFile).then(function(e){!e.isError&&e.data?console.log(e.data):console.log(e)})}}]),adminApp.controller("galleryController",["$scope","$location","getData","postData","dateService",function(e,n,t,o,a){console.log("gallery controller runs"),e.$parent.path="/gallery",e.isDataUpdated=!1,t.getContent("/api/AdminValues","adminGallery").then(function(o){console.log(o),e.data=o,t.getContent("/api/AdminValues","machines").then(function(t){console.log(t),null==t?n.path("/"):e.machines=t})}),e.clearAvailibilityTextBox=function(e){e.availibilityLabel="",e.availibilityDate=null},e.editFullInfo=function(n){e.isDisplayFullInfoPanel=!0,e.activeItem=n},e.isExpired=function(e){return a.isExpired(e)},e.save=function(){if(console.log("save called"),!e.galleryForm.$invalid&&!e.galleryForm.$pristine||!e.fullInfoForm.$invalid&&!e.fullInfoForm.$pristine){e.updatedMachines=[];for(var n=0;n<e.machines.gallery.items.length;n++){var t={},a=e.machines.gallery.items[n];t.Name=a.name,t.IsAvailable=a.availibility,t.AvailibilityLabel=a.availibilityLabel,t.AvailibilityDate=a.availibilityDate,t.IsDiscount=a.discount,t.Price=a.price,t.FullInfo=JSON.stringify(a.fullInfo),e.updatedMachines.push(t)}console.log("short collection:"),console.log(e.updatedMachines),o.postContent("/api/Gallery",e.updatedMachines).then(function(n){!n.isError&&n.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}}}]),adminApp.controller("newsController",["$scope","$location","getData","postData",function(e,n,t,o){console.log("news controller runs"),e.$parent.path="/news",e.isDataUpdated=!1,t.getContent("/api/Values","home").then(function(n){console.log(n),e.data=n}),e.postToServer=function(){if(!e.newsForm.$invalid&&!e.newsForm.$pristine){var n=JSON.stringify(JSON.stringify(e.data.sections));o.postContent("/api/News",n).then(function(n){!n.isError&&n.data?(e.isDataUpdated=!0,e.isError=!1):e.isError=!0})}},e.postImage=function(){(e.imageForm.$invalid||e.imageForm.$pristine&&e.myFile)&&o.postFile("/api/Image",e.myFile).then(function(n){if(!n.isError&&n.data){if(n.data.Message){var t={};t.img={},t.img.imgSrc=n.data.Message,t.textHtml="<h3 class='textBlock-subheadline'>Заголовок новости</h3><p>Текст новости</p><p class='textBlock-text--italic'>Big Trailler - самые надёжные прицепы твоего города!</p>",e.data.sections.splice(0,0,t)}}else console.log(n)})}}]),adminApp.controller("scrollToAnchorController",["$scope","anchorSmoothScroll",function(e,n){e.gotoElement=function(e){n.scrollTo(e)}}]),adminApp.controller("signinController",["$scope","$http","$location","$cookies","getData","postData","myVars",function(e,n,t,o,a,i,r){console.log("sign in controller runs"),e.$parent.path="/sign in",e.isError=!1,a.getContent("/api/Values","signin").then(function(n){e.data=n,console.log(e.data),e.submit=function(){e.messagesForm.$invalid||i.postContent("/api/AdminValues",e.form).then(function(n){!n.isError&&n.data?(e.isError=!1,r.tokenValue=n.data.Value,o.put("X-Token",r.tokenValue),t.path("/gallery")):(e.isError=!0,console.log("error occured on our server"),console.log(n))})}})}]),adminApp.directive("clearFileInput",function(){return{restrict:"A",link:function(e,n,t){n.on("submit",function(){var e=document.getElementsByName(t.clearFileInput)[0];return angular.element(e).val(null),angular.element(e).triggerHandler("change"),!1})}}}),adminApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(n,t,o){var a=e(o.fileModel),i=a.assign;t.bind("change",function(){n.$apply(function(){i(n,t[0].files[0])})})}}}]),adminApp.service("anchorSmoothScroll",function(){this.scrollTo=function(e){var n=function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}(),t=function(e){for(var n=document.getElementById(e),t=n.offsetTop,o=n;o.offsetParent&&o.offsetParent!=document.body;)o=o.offsetParent,t+=o.offsetTop;return t}(e),o=t>n?t-n:n-t;if(o<100)return void scrollTo(0,t);var a=Math.round(o/100);a>=20&&(a=20);var i=Math.round(o/25),r=t>n?n+i:n-i,l=0;if(t>n)for(var s=n;s<t;s+=i)setTimeout("window.scrollTo(0, "+r+")",l*a),r+=i,r>t&&(r=t),l++;else for(var s=n;s>t;s-=i)setTimeout("window.scrollTo(0, "+r+")",l*a),r-=i,r<t&&(r=t),l++}}),adminApp.service("dateService",function(){return{isExpired:function(e){if(e){return new Date>new Date(e)}return null}}}),adminApp.service("getData",["$http","$cookies","myVars",function(e,n,t){return{getContent:function(o,a){var i=t.tokenValue;return console.log("token value inside GETDATA service:"),console.log(i),i||(i=n.get("X-Token")),console.log("X-token"),console.log(i),e({method:"Get",url:o,params:{sectionName:a},headers:{"X-Token":i}}).then(function(e){return e.data},function(e){console.log("error")})}}}]),adminApp.service("postData",["$http","$cookies","myVars",function(e,n,t){var o=function(e){var o=t.tokenValue;return o||(o=n.get("X-Token")),e?e["X-Token"]=o:e={"X-Token":o},e};return{postContent:function(n,t,a){return e({method:"POST",url:n,data:t,headers:o(a)}).then(function(e){return e},function(e){return e.isError=!0,e})},postFile:function(n,t,a){var i=new FormData;return i.append("file",t),a?a["Content-Type"]=void 0:a={"Content-Type":void 0},e({method:"POST",url:n,data:i,transformRequest:angular.identity,headers:o(a)}).then(function(e){return e},function(e){return e.isError=!0,e})}}}]),adminApp.value("myVars",{tokenValue:null});