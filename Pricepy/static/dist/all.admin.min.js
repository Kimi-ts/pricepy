var adminApp=angular.module("adminApp",["ngRoute","ngSanitize","ngCookies","ngAnimate","720kb.datepicker"]);adminApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"static/src/admin/templates/signin.htm",controller:"signinController"}).when("/gallery",{templateUrl:"static/src/admin/templates/gallery.htm",controller:"galleryController"}).when("/news",{templateUrl:"static/src/admin/templates/news.htm",controller:"newsController"}).when("/actions",{templateUrl:"static/src/admin/templates/actions.htm",controller:"actionsController"})}]),adminApp.controller("adminController",["$scope","$location","$http","getData","dateService",function(e,t,n,o,i){e.path=t.path(),void 0,o.getContent("/api/Values","header").then(function(t){e.data={},e.data.header=t,void 0,o.getContent("/api/Values","footer").then(function(t){e.data.footer=t,void 0})})}]),adminApp.controller("actionsController",["$scope","$http","$location","$cookies","$timeout","getData","postData","myVars",function(e,t,n,o,i,a,r,l){void 0,e.$parent.path="/actions",e.isDataUpdated=!1,a.getContent("/api/Values","home").then(function(t){void 0,e.data=t}),e.postToServer=function(){if(!e.bannersForm.$invalid&&!e.bannersForm.$pristine){e.isHiglightFirstNewsItem=!1,e.isDataUpdated=!1,e.isError=!1;var t=JSON.stringify(JSON.stringify(e.data.banners));r.postContent("/api/Banners",t).then(function(t){!t.isError&&t.data?(s("isDataUpdated"),e.isError=!1):s("isError")})}},e.addNewBanner=function(){var t={};t.backgroundImageUrl="Content/Images/banners/2.jpg",e.data.banners.push(t),e.bannersForm.$setDirty()},e.removeItem=function(t){e.data.banners.splice(t,1),e.bannersForm.$setDirty()};var s=function(t){e[t]=!0,i(function(){e[t]=!1},4e3)}}]),adminApp.controller("galleryController",["$scope","$location","$timeout","getData","postData","dateService",function(e,t,n,o,i,a){void 0,e.$parent.path="/gallery",e.isDataUpdated=!1,o.getContent("/api/AdminValues","adminGallery").then(function(n){void 0,e.data=n,o.getContent("/api/AdminValues","machines").then(function(n){void 0,null==n?t.path("/"):e.machines=n})}),e.clearAvailibilityTextBox=function(e){e.availibilityLabel="",e.availibilityDate=null},e.editFullInfo=function(t){e.isDisplayFullInfoPanel=!0,e.activeItem=t},e.addNewPriceRow=function(){var t={name:"",value:""};e.activeItem.fullInfo.prices.push(t)},e.removePriceRow=function(t){e.activeItem.fullInfo.prices.splice(t,1),e.fullInfoForm.$setDirty()},e.isExpired=function(e){return a.isExpired(e)},e.save=function(){if(void 0,!e.galleryForm.$invalid&&!e.galleryForm.$pristine||!e.fullInfoForm.$invalid&&!e.fullInfoForm.$pristine){e.updatedMachines=[];for(var t=0;t<e.machines.gallery.items.length;t++){var n={},o=e.machines.gallery.items[t];n.Name=o.name,n.IsAvailable=o.availibility,n.AvailibilityLabel=o.availibilityLabel,n.AvailibilityDate=o.availibilityDate,n.IsDiscount=o.discount,n.IsSuperAction=o.isSuperAction,n.Price=o.price,n.BookedDates=o.bookedDates,n.FullInfo=JSON.stringify(o.fullInfo),e.updatedMachines.push(n)}void 0,void 0,i.postContent("/api/Gallery",e.updatedMachines).then(function(t){!t.isError&&t.data?(r("isDataUpdated"),e.isError=!1):e.isError=!0})}};var r=function(t){e[t]=!0,n(function(){e[t]=!1},4e3)}}]),adminApp.controller("newsController",["$scope","$location","getData","postData","$timeout",function(e,t,n,o,i){void 0,e.$parent.path="/news",e.isDataUpdated=!1,e.videoUrl="",e.isShowInstructions=!1,n.getContent("/api/Values","home").then(function(t){void 0,e.data=t}),e.postToServer=function(){if(!e.newsForm.$invalid&&!e.newsForm.$pristine){e.isHiglightFirstNewsItem=!1,e.isDataUpdated=!1,e.isError=!1,e.isImageUploadError=!1;var t=JSON.stringify(JSON.stringify(e.data.sections));o.postContent("/api/News",t).then(function(t){!t.isError&&t.data?(a("isDataUpdated"),e.isError=!1):a("isError")})}},e.postImage=function(){(e.imageForm.$invalid||e.imageForm.$pristine&&e.myFile)&&o.postFile("/api/Image",e.myFile).then(function(t){if(!t.isError&&t.data){if(t.data.Message){e.isImageUploadError=!1;var n={};n.img={},n.img.imgSrc=t.data.Message,n.textHtml="<h3 class='textBlock-subheadline'>Заголовок новости</h3><p>Текст новости</p><p class='textBlock-text--italic'>Big Trailler - самые надёжные прицепы твоего города!</p>",e.data.sections.splice(0,0,n),e.isHiglightFirstNewsItem=!0}}else a("isImageUploadError"),void 0})},e.postVideo=function(){if(e.videoUrl){var t={};t.video={},t.video.url=e.videoUrl,t.textHtml="<h3 class='textBlock-subheadline'>Заголовок новости</h3><p>Текст новости</p><p class='textBlock-text--italic'>Big Trailler - самые надёжные прицепы твоего города!</p>",e.data.sections.splice(0,0,t),e.isHiglightFirstNewsItem=!0,e.videoUrl=""}},e.removeItem=function(t){e.data.sections.splice(t,1),e.newsForm.$setDirty()},e.toggleInstructionVisibility=function(){e.isShowInstructions=!e.isShowInstructions};var a=function(t){e[t]=!0,i(function(){e[t]=!1},4e3)}}]),adminApp.controller("scrollToAnchorController",["$scope","anchorSmoothScroll",function(e,t){e.gotoElement=function(e){t.scrollTo(e)}}]),adminApp.controller("signinController",["$scope","$http","$location","$cookies","getData","postData","myVars",function(e,t,n,o,i,a,r){void 0,e.$parent.path="/sign in",e.isError=!1,i.getContent("/api/Values","signin").then(function(t){e.data=t,void 0,e.submit=function(){e.messagesForm.$invalid||a.postContent("/api/AdminValues",e.form).then(function(t){!t.isError&&t.data?(e.isError=!1,r.tokenValue=t.data.Value,o.put("X-Token",r.tokenValue),n.path("/gallery")):(e.isError=!0,void 0,void 0)})}})}]),adminApp.directive("clearFileInput",function(){return{restrict:"A",link:function(e,t,n){t.on("submit",function(){var e=document.getElementsByName(n.clearFileInput)[0];return angular.element(e).val(null),angular.element(e).triggerHandler("change"),!1})}}}),adminApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,o){var i=e(o.fileModel),a=i.assign;n.bind("change",function(){t.$apply(function(){a(t,n[0].files[0])})})}}}]),adminApp.service("anchorSmoothScroll",function(){this.scrollTo=function(e){var t=function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}(),n=function(e){for(var t=document.getElementById(e),n=t.offsetTop,o=t;o.offsetParent&&o.offsetParent!=document.body;)o=o.offsetParent,n+=o.offsetTop;return n}(e),o=n>t?n-t:t-n;if(o<100)return void scrollTo(0,n);var i=Math.round(o/100);i>=20&&(i=20);var a=Math.round(o/25),r=n>t?t+a:t-a,l=0;if(n>t)for(var s=t;s<n;s+=a)setTimeout("window.scrollTo(0, "+r+")",l*i),r+=a,r>n&&(r=n),l++;else for(var s=t;s>n;s-=a)setTimeout("window.scrollTo(0, "+r+")",l*i),r-=a,r<n&&(r=n),l++}}),adminApp.service("dateService",function(){return{isExpired:function(e){if(e){return new Date>new Date(e)}return null}}}),adminApp.service("getData",["$http","$cookies","myVars",function(e,t,n){return{getContent:function(o,i){var a=n.tokenValue;return void 0,void 0,a||(a=t.get("X-Token")),void 0,void 0,e({method:"Get",url:o,params:{sectionName:i},headers:{"X-Token":a}}).then(function(e){return e.data},function(e){void 0})}}}]),adminApp.service("postData",["$http","$cookies","myVars",function(e,t,n){var o=function(e){var o=n.tokenValue;return o||(o=t.get("X-Token")),e?e["X-Token"]=o:e={"X-Token":o},e};return{postContent:function(t,n,i){return e({method:"POST",url:t,data:n,headers:o(i)}).then(function(e){return e},function(e){return e.isError=!0,e})},postFile:function(t,n,i){var a=new FormData;return a.append("file",n),i?i["Content-Type"]=void 0:i={"Content-Type":void 0},e({method:"POST",url:t,data:a,transformRequest:angular.identity,headers:o(i)}).then(function(e){return e},function(e){return e.isError=!0,e})}}}]),adminApp.value("myVars",{tokenValue:null});